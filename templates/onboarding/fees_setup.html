{% extends "onboarding/base_onboarding.html" %}

{% block step_title %}Set Up Fees{% endblock %}
{% block step_description %}
Add your schoolâ€™s fee structure for each division so billing runs smoothly.
{% endblock %}
{% load custom_tags %}

{% block form_content %}
<div class="max-w-4xl mx-auto">
  <form method="post" class="space-y-8 bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-neutral-200">
    {% csrf_token %}

    {% if divisions %}
      <div class="grid gap-6">
        {% for div in divisions %}
          <div class="p-5 border border-neutral-200 rounded-xl bg-neutral-50 hover:shadow-md transition">
            <h3 class="font-semibold text-lg text-neutral-800">{{ div.name|capfirst }}</h3>
            <div class="mt-4 grid gap-4">

              {% for fee_type, fee_label in fee_types %}
                {% get_fee existing_fees div.id fee_type as fee %}
                <div class="flex flex-col sm:flex-row sm:items-center gap-2">
                  <label class="sm:w-1/3 text-sm font-medium text-neutral-700">{{ fee_label }}</label>
                  <div class="w-full">
                    <input type="number"
           name="fee_{{ div.id }}_{{ fee_type }}"
           placeholder="Enter amount"
           min="0"
           step="0.01"
           value="{{ fee.amount|default_if_none:'' }}"
           class="w-full px-4 py-2 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition">

    {% if fee_type == "OTHER" %}
      <textarea name="description_{{ div.id }}_{{ fee_type }}"
                placeholder="Add description"
                class="w-full px-4 py-2 rounded-lg border border-neutral-300 focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition mt-1">{{ fee.description|default_if_none:'' }}</textarea>
    {% endif %}
                  
                  </div>
                </div>
              {% endfor %}

            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center text-neutral-500">No divisions found for your school.</p>
    {% endif %}

    <!-- ðŸ”¥ Form Actions -->
    <div class="flex justify-between pt-6">
      <a href="{% url 'accounts:pending_approval' %}" 
         class="px-5 py-2 rounded-lg border border-neutral-300 text-neutral-700 hover:bg-neutral-100 transition">
        Cancel
      </a>
      <button type="submit" 
              class="px-6 py-2 bg-primary-500 text-white rounded-lg shadow hover:bg-primary-600 transition">
        Save & Continue
      </button>
    </div>
  </form>
</div>
{% endblock %}
