{% extends "onboarding/base_onboarding.html" %}

{% block step_title %}Set Up Divisions{% endblock %}
{% block step_description %}
Organize your school into divisions or departments. Select general ones or add your own custom divisions.
{% endblock %}

{% block form_content %}
<form method="post" id="division-form" class="space-y-8">
  {% csrf_token %}

  <!-- Existing Divisions -->
  {% if existing_divisions %}
  <div class="p-6 bg-neutral-50 rounded-xl border border-neutral-200">
    <h3 class="font-semibold text-lg text-neutral-800 mb-3">Existing Divisions</h3>
    <ul class="list-disc pl-5 space-y-1 text-neutral-600">
      {% for div in existing_divisions %}
        <li>{{ div.get_name_display }}{% if div.description %} â€” {{ div.description }}{% endif %}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- General Divisions -->
  <div>
    <h3 class="font-semibold text-lg text-neutral-800 mb-3">Select from General Divisions</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      {% for value, label in general_divisions %}
      <label class="flex items-center gap-3 p-4 rounded-xl border border-neutral-300 bg-white hover:bg-primary-50 transition cursor-pointer">
        <input type="checkbox" name="general_divisions" value="{{ value }}"
               class="w-5 h-5 accent-primary-600"
               {% if value in preselected_general %}checked{% endif %}>
        <span class="font-medium text-neutral-800">{{ label }}</span>
      </label>
      {% endfor %}
    </div>
  </div>

  <!-- Custom Divisions -->
  <div>
    <h3 class="font-semibold text-lg text-neutral-800 mb-3">Add Custom Divisions</h3>
    <div id="custom-division-container" class="space-y-4"></div>
    <button type="button" id="add-division-btn"
            class="inline-flex items-center gap-2 px-4 py-2 bg-secondary-500 hover:bg-secondary-600 text-white rounded-lg shadow transition">
      <i class="fas fa-plus"></i> Add Division
    </button>
  </div>

  <!-- Navigation -->
  <div class="flex justify-between items-center pt-4 border-t border-neutral-200">
    <a href="{% url 'onboarding:school_setup' %}"
       class="inline-flex items-center gap-2 px-6 py-2 rounded-lg border border-neutral-300 text-neutral-700 hover:bg-neutral-100 transition">
      <i class="fas fa-arrow-left"></i> Back
    </a>
    <button type="submit"
            class="inline-flex items-center gap-2 px-6 py-2 rounded-lg bg-primary-600 hover:bg-primary-700 text-white shadow transition">
      Next <i class="fas fa-arrow-right"></i>
    </button>
  </div>
</form>

<script>
let container = document.getElementById("custom-division-container");
let addBtn = document.getElementById("add-division-btn");
let formIdx = 0;

addBtn.addEventListener("click", () => {
  const div = document.createElement("div");
  div.classList.add("p-4","border","rounded-xl","bg-neutral-50","space-y-2","relative","shadow-sm");
  div.innerHTML = `
    <input type="text" name="custom_name_${formIdx}" placeholder="Division Name" required
           class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
    <textarea name="custom_description_${formIdx}" placeholder="Description"
              class="w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-primary-500 focus:border-primary-500"></textarea>
    <button type="button" class="remove-division text-danger-600 hover:text-danger-700 font-medium">Remove</button>
  `;
  container.appendChild(div);
  formIdx++;
});

container.addEventListener("click", e => {
  if (e.target.classList.contains("remove-division")) {
    e.target.parentElement.remove();
  }
});
</script>
{% endblock %}
