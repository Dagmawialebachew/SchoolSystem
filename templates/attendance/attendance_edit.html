{# templates/attendance/attendance_edit.html #}
{% extends "base.html" %}
{% block title %}Edit attendance{% endblock %}
{% block content %}
<div class="max-w-xl mx-auto bg-white shadow-sm border border-neutral-200 rounded-2xl p-6">
  <h2 class="text-lg font-semibold text-neutral-900 mb-4">Create or update attendance</h2>

  <form id="attForm" class="space-y-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold text-neutral-700 mb-2">Student ID</label>
        <input name="student_id" class="w-full rounded-lg border-neutral-300 px-3 py-2 text-sm shadow-sm" required />
      </div>
      <div>
        <label class="block text-sm font-semibold text-neutral-700 mb-2">Class program ID</label>
        <input name="class_program_id" class="w-full rounded-lg border-neutral-300 px-3 py-2 text-sm shadow-sm" required />
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold text-neutral-700 mb-2">Date</label>
        <input type="date" name="date" value="{{ today|date:'Y-m-d' }}" class="w-full rounded-lg border-neutral-300 px-3 py-2 text-sm shadow-sm" required />
      </div>
      <div>
        <label class="block text-sm font-semibold text-neutral-700 mb-2">Session</label>
        <input name="session" placeholder="optional" class="w-full rounded-lg border-neutral-300 px-3 py-2 text-sm shadow-sm" />
      </div>
    </div>

    <div>
      <label class="block text-sm font-semibold text-neutral-700 mb-2">Status</label>
      <select name="status" class="w-full rounded-lg border-neutral-300 px-3 py-2 text-sm shadow-sm">
        <option value="PRESENT">Present</option>
        <option value="ABSENT">Absent</option>
        <option value="LATE">Late</option>
        <option value="HALF_DAY">Half Day</option>
      </select>
    </div>

    <div>
      <label class="block text-sm font-semibold text-neutral-700 mb-2">Remarks</label>
      <textarea name="remarks" rows="3" class="w-full rounded-lg border-neutral-300 px-3 py-2 text-sm shadow-sm"></textarea>
    </div>

    <div class="flex justify-end gap-2">
      <a href="{% url 'attendance:list' %}" class="px-3 py-2 rounded-lg text-sm bg-neutral-100 text-neutral-800 hover:bg-neutral-200">Cancel</a>
      <button type="submit" class="px-4 py-2 rounded-lg text-sm font-semibold bg-primary-600 text-white hover:bg-primary-700">Save</button>
    </div>
  </form>
</div>


<script>
document.getElementById("attForm").addEventListener("submit", (e) => {
  e.preventDefault();
  const fd = new FormData(e.target);
  fetch("{% url 'attendance:edit' %}", {
    method: "POST",
    headers: {"X-CSRFToken": getCsrf()},
    body: new URLSearchParams(fd)
  })
  .then(r => {
    if (!r.ok) return r.text().then(t => Promise.reject(t));
    return r.json();
  })
  .then(() => location.href = "{% url 'attendance:list' %}")
  .catch(err => alert(err || "Failed to save"));
});
function getCsrf() {
  const name = "csrftoken";
  const cookies = document.cookie.split(";").map(c => c.trim());
  for (const c of cookies) if (c.startsWith(name + "=")) return c.substring(name.length + 1);
  return "";
}
</script>
{% endblock %}
